window.onload=function(){startWS()};const wsProtocol=window.location.protocol==="https:"?"wss":"ws";function startWS(){if(location.pathname==="/fi"||location.pathname==="/en"){var c=location.pathname==="/fi"?"fi":"en";var b=wsProtocol+"://"+window.location.hostname+":"+window.location.port+"/ws/";var a=new WebSocket(b+c,wsProtocol);a.onmessage=function(d){if(d.data){handleMessage(d.data,c)}};a.onopen=function(){console.log("ws socket open");if(window.timerID){window.clearTimeout(window.timerID);window.timerID=0}};a.onclose=function(){a=null;console.log("ws socket closed",!window.timerID);if(!window.timerID){window.timerID=setTimeout(function(){startWS()},8000)}};a.onerror=function(d){console.log("ws socket error",d);if(window.timerID){window.clearTimeout(window.timerID);window.timerID=0}}}}function handleMessage(d,f){var e=-999;const b=JSON.parse(d);if(b&&b.news){if(b.news.length>0&&e!==b.news[0].id){for(var a=4;a>=0;a--){if(document.getElementById(b.news[a].id)===null){var c=makeNode(b,a,f);prepend(c)}}e=b.news[0].id}}}var prepend=function(b){var a=document.getElementById("news-container");a.insertBefore(b,a.firstChild);a.removeChild(a.lastChild)};var makeNode=function(n,f,d){var h=n.news[f].category.categoryName.toLowerCase();var k=d==="en"?n.news[f].category.categoryEnName:n.news[f].category.categoryName;var m=document.createElement("div");m.setAttribute("class","item new");var b=document.createElement("div");b.setAttribute("class","source");b.innerHTML=n.news[f].rssSource;var e=document.createElement("div");e.setAttribute("class","date");e.innerHTML=moment(n.news[f].pubDate).format("DD.MM. HH:mm");var g=document.createElement("div");g.setAttribute("class","link");var c=document.createElement("div");var l=document.createElement("a");l.setAttribute("href","/"+d+"/category/"+h+"/0");c.setAttribute("class","category");l.innerHTML=k;c.appendChild(l);var j=document.createElement("a");j.setAttribute("id",n.news[f].id);j.setAttribute("href",n.news[f].rssLink);j.setAttribute("target","_blank");j.innerHTML=n.news[f].rssTitle;g.appendChild(j);m.appendChild(e);m.appendChild(b);m.appendChild(c);m.appendChild(g);return m};var xmlhttp=new XMLHttpRequest();function saveClick(a){xmlhttp.open("GET","/api/click/"+a,true);xmlhttp.send()}document.addEventListener("DOMContentLoaded",function(){var b=document.getElementsByClassName("itemClick");for(var a=0;a<b.length;a++){b[a].addEventListener("click",function(){saveClick(this.id)})}});(function(e,a){var d=a.getElementById("layout"),f=a.getElementById("menu"),c=a.getElementById("menuLink");function b(j,k){var h=j.className.split(/\s+/),l=h.length;for(var g=0;g<l;g++){if(h[g]===k){h.splice(g,1);break}}if(l===h.length){h.push(k)}j.className=h.join(" ")}c.onclick=function(h){var g="active";h.preventDefault();b(d,g);b(f,g);b(c,g)}})(this,this.document);